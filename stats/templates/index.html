<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  {% load static %}
  {% load humanize %}
  {% load mathfilters %}
  {% load stat_extras %}

  <title>{{ guild.name }} Stats</title>

  <link rel="stylesheet" href="{% static 'style.css' %}" type="text/css" />
  <link rel="stylesheet" href="{% static 'js/tablesorter/css/theme.custom.css' %}" type="text/css" />
  <link rel="icon" href="{{ guild.icon }}">

  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
  <script type="text/javascript" src="{% static 'js/tablesorter/js/jquery.tablesorter.js' %}"></script>

  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>


  <script type="text/javascript" src="{% static 'js/chart_setup.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/tablesort_setup.js' %}"></script>

</head>

<body>
  <center>
    <h1>
      {{ guild.name }} Stats (rendered on {% now "n/j/o" %})
    </h1>
    <span class="txt2">
      Statistics generated from {{ first_message_date|date:"l n/j/o" }} to {{ last_message_date|date:"l n/j/o" }}
    </span>
    <br>
    <span class="txt2">
      {{ number_of_users|intcomma }} different users sent a total of {{ total_messages|intcomma }} messages in this server during this {{ total_days|intcomma }}-day reporting period
    </span>
    
    <img src="{% static 'assets/pipeltv.png' %}" height="3" width="90%" alt="">
    <br>
    <br>

    <!-- 
      When's the best time to chat?
    -->

    <h3>When's the best time to chat?</h3>
    <table cellspacing="1" cellpadding="2">
      <tbody>
        <tr class="s1" valign="bottom">
          {% for hour, value in total_hour_counts.items %}
            <td class="tgr">
              <!-- hour percentage value -->
              {{ value|div:total_messages|mul:100|floatformat:1 }}%
              <br>
              <!-- changes color of png based on time of day -->
              <img src='{% static hour|set_hour_png %}' width="18" height="{% widthratio value total_hour_count_max 120 %}">
            </td>
          {% endfor %}
        </tr>

        <!-- lists out every hour from 12AM to 11PM -->
        <tr class="s3">
          {% with 'AM PM' as mlist %}
            {% for meridem in mlist.split %}
              {% with '12 1 2 3 4 5 6 7 8 9 10 11' as hourlist %}
                {% for hour in hourlist.split %}
                  <td class="cd">{{ hour }}{{ meridem }}</td>
                {% endfor %}
              {% endwith %}
            {% endfor %}
          {% endwith %}
        </tr>
      </tbody>
    </table>
    <br>
    <span class="txt2">PST / PDT (UTC-8/7)</span>
    <br>
    <br>
    <table border="0" class="txt1">
      <tbody>
        <tr>
          <td class="tinv">
            <img src="{% static 'assets/pipe1v.png' %}" height="15" width="30" align="top" title="0-6">
            Night
          </td>
          <td class="tinv" width="20"></td>
          <td class="tinv">
            <img src="{% static 'assets/pipe2v.png' %}" height="15" width="30" align="top" title="6-12">
            Morning
          </td>
          <td class="tinv" width="20"></td>
          <td class="tinv">
            <img src="{% static 'assets/pipe3v.png' %}" height="15" width="30" align="top" title="12-18">
            Afternoon
          </td>
          <td class="tinv" width="20"></td>
          <td class="tinv">
            <img src="{% static 'assets/pipe4v.png' %}" height="15" width="30" align="top" title="18-24">
            Evening
          </td>
        </tr>
      </tbody>
    </table>

    <img src="{% static 'assets/pipeltv.png' %}" height="3" width="90%" alt="">
    <br>
    <br>
    <!-- 
      Day-by-day server load
    -->
    <h3>Day-by-day server load</h3>
    <div id="chart_div"></div>
    <img src="{% static 'assets/pipeltv.png' %}" height="3" width="90%" alt="">
    <br>
    <br>
    <!-- 
      100 Most Talkative Users
    -->
    <h3>100 Most Talkative Users</h3>
    <table border="0" cellspacing="1" cellpadding="2" 
    class="tablesorter user_rankings" id="user_rankings">
      <tbody>
        <thead class="user_ranking_headers">
          <!-- tablesort settings for each column defined here-->
          <th class="blankheader" data-sorter="false">&nbsp;</th>
          <th data-sorter="false">Nick</th>
          <th data-lockedorder="desc" class="sorter-bignumber">Line Count</th>
          <th data-lockedorder="desc">Lines Per Day</th>
          <th data-sorter="false">Interesting Vocabulary</th>
          <th data-sorter="false">Favorite Emojis</th>
        </thead>
        {% for user_dict in top_100_users_display %}
          <tr>
            <td class="rank">
              {{ forloop.counter }}
            </td>
            <td>
              <img src="{{ user_dict.user.avatar }}" height="30">
              &nbsp;
              {{ user_dict.user.tag }}
            </td>

            <td class="">
              <img src="{% static 'assets/pipe1v.png' %}" height="15" width="{% widthratio user_dict.night_hour_count most_messages 100 %}"><!--
              --><img src="{% static 'assets/pipe2v.png' %}" height="15" width="{% widthratio user_dict.morning_hour_count most_messages 100 %}"><!--
              --><img src="{% static 'assets/pipe3v.png' %}" height="15" width="{% widthratio user_dict.afternoon_hour_count most_messages 100 %}"><!--
              --><img src="{% static 'assets/pipe4v.png' %}" height="15" width="{% widthratio user_dict.evening_hour_count most_messages 100 %}">
              {{ user_dict.user.messages|intcomma }}
            </td>

            <td>
              {{ user_dict.average_daily_messages|floatformat:1 }}
            </td>

            <td class="words">
              {{ user_dict.favorite_words |join:", " }}
            </td>

            <td>
              {% for emoji_URL in user_dict.favorite_custom_emojis %}
                <img src="{{ emoji_URL }}" height="15">
              {% endfor %}
              <font size="+1">{{ user_dict.favorite_default_emojis |join:" " }}</font>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <img src="{% static 'assets/pipeltv.png' %}" height="3" width="90%" alt="">
    <br>
    <br>

    <!-- 
      Time of Day Stats
    -->
    <h3>Time of day stats</h3>
    <table cellspacing="1" cellpadding="2" id=""></table>
  </center>
  
</body>

</html>