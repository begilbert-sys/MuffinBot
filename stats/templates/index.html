<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  {% load static %}
  {% load humanize %}
  {% load mathfilters %}
  {% load stat_extras %}
  <title>{{ guild_name }} Stats</title>
  <link rel="stylesheet" href="{% static 'style.css' %}" type="text/css" />
</head>

<body>
  <center>
    <h1>
      {{ guild_name }} Stats (rendered on {% now "n/j/o" %})
    </h1>
    <span class="txt2">
      Statistics generated from {{ first_message_date|date:"l n/j/o" }} to {{ last_message_date|date:"l n/j/o" }}
    </span>
    <br>
    <span class="txt2">
      {{ database|length|intcomma }} different users sent a total of {{ total_messages|intcomma }} messages in this server during this {{ reporting_period_days|intcomma }}-day reporting period
    </span>
    
    <img src="{% static 'pipeltv.png' %}" height="3" width="90%" alt="">
    <br>
    <br>

    <!-- 
      When's the best time to chat?
    -->

    <h3>When's the best time to chat?</h3>
    <table cellspacing="1" cellpadding="2">
      <tbody>
        <tr class="s1" valign="bottom">
          {% for hour, value in hour_counts.items %}
            <td class="tgr">
              <!-- hour percentage value -->
              {{ value|div:total_messages|mul:100|floatformat:1 }}%
              <br>
              <!-- changes color of png based on time of day -->
              <img src='{% static hour|set_hour_png %}' width="18" height="{% widthratio value hour_max 120 %}">
            </td>
          {% endfor %}
        </tr>

        <!-- lists out every hour from 12AM to 11PM -->
        <tr class="s3">
          {% with 'AM PM' as mlist %}
            {% for meridem in mlist.split %}
              {% with '12 1 2 3 4 5 6 7 8 9 10 11' as hourlist %}
                {% for hour in hourlist.split %}
                  <td class="cd">{{ hour }}{{ meridem }}</td>
                {% endfor %}
              {% endwith %}
            {% endfor %}
          {% endwith %}
        </tr>
      </tbody>
    </table>
    <br>
    <span class="txt2">PST / PDT (UTC-8/7)</span>
    <br>
    <br>
    <table border="0" class="txt1">
      <tbody>
        <tr>
          <td class="tinv">
            <img src="{% static 'pipe1v.png' %}" height="15" width="30" align="top" title="0-6">
            Night
          </td>
          <td class="tinv" width="20"></td>
          <td class="tinv">
            <img src="{% static 'pipe2v.png' %}" height="15" width="30" align="top" title="6-12">
            Morning
          </td>
          <td class="tinv" width="20"></td>
          <td class="tinv">
            <img src="{% static 'pipe3v.png' %}" height="15" width="30" align="top" title="12-18">
            Afternoon
          </td>
          <td class="tinv" width="20"></td>
          <td class="tinv">
            <img src="{% static 'pipe4v.png' %}" height="15" width="30" align="top" title="18-24">
            Evening
          </td>
        </tr>
      </tbody>
    </table>

    <img src="{% static 'pipeltv.png' %}" height="3" width="90%" alt="">
    <br>
    <br>

    <!-- 
      100 Most Talkative Users
    -->
    <h3>100 Most Talkative Users</h3>
    <table border="0" cellspacing="1" cellpadding="2" class="t2">
      <tbody>
        <tr class="t1">
          <td class="tinv">&nbsp;</td>
          <td class="c">Nick</td>
          <td class="c">Line Count</td>
          <td class="c">Average Lines Per Day</td>
          <td colspan="2" class="c">Favorite Words</td>
        </tr>
        {% for user in user_ranking_display %}
          <tr class="{% cycle 'darkrow' 'lightrow' %}">
            <td class="rank">
              {{ forloop.counter }}
            </td>
            <td class="win">
              {{ user.username }}
            </td>
            <td class="win">
              {{ user.messages }}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

  </center>
  
</body>

</html>